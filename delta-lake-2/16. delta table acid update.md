## Delta Table ACID


✅ Yes — Delta Lake fully supports ACID updates.
That’s one of its biggest advantages over plain Parquet or CSV files.



### 📌 What ACID Means in Delta Lake

ACID =
- 	Atomicity → Either the entire transaction succeeds or nothing does.
- 	Consistency → The table is always in a valid state before and after the operation.
- 	Isolation → Concurrent reads and writes don’t interfere; readers see a consistent snapshot.
- 	Durability → Once a transaction commits, it’s permanent and recoverable.

Delta Lake achieves this using transaction logs (_delta_log) + versioned data files.


---

### 🧪 Examples of ACID Update in Delta Lake

1️⃣ UPDATE statements (in-place updates)

You can use SQL directly:

```sql
UPDATE delta.`/delta/path/to/table`
SET status = 'inactive'
WHERE last_login < '2022-01-01';
```

Or PySpark API:

```python
from delta.tables import DeltaTable

delta_table = DeltaTable.forPath(spark, "/delta/path/to/table")
delta_table.update(
    condition="last_login < '2022-01-01'",
    set={"status": "'inactive'"}
)
```

👉 Delta rewrites only the affected files atomically.


2️⃣ DELETE


```sql
DELETE FROM delta.`/delta/path/to/table` WHERE is_deleted = true;
```

Or PySpark API:

```python
delta_table.delete("is_deleted = true")
```


3️⃣ MERGE (UPSERT)

For inserting new rows and updating existing rows in a single ACID transaction:

 PySpark API:

```python
(
    delta_table.alias("t")
    .merge(updates_df.alias("s"), "t.id = s.id")
    .whenMatchedUpdateAll()
    .whenNotMatchedInsertAll()
    .execute()
)
```

This is fully atomic — no partial writes.


4️⃣ Transaction Isolation & Versioning

Delta uses Snapshot Isolation:
- 	Readers always see a consistent snapshot of the table at the time their query started.
- 	Writers work on new versions; old versions remain available until vacuumed.

You can time travel to previous versions too:

```sql
SELECT * FROM delta.`/delta/path/to/table` VERSION AS OF 5;
```


5️⃣ Concurrency Safety

Multiple jobs can read while another is updating — safely.

Multiple writers use optimistic concurrency control:
- 	If two transactions touch the same data files, the second one retries automatically.
- 	No locking needed like in RDBMS.

---

### ⚡ Why This Matters


🆚 Delta Lake vs Parquet/CSV: ACID Operations


| Operation              | Parquet/CSV                | Delta Lake                |
|------------------------|----------------------------|---------------------------|
| UPDATE / DELETE        | ❌ Not supported directly   | ✅ Supported (ACID)        |
| MERGE / Upsert         | ❌ Complex & manual         | ✅ Native with ACID        |
| Concurrency            | ❌ Risk of corruption       | ✅ Snapshot isolation      |
| Rollback / Versioning  | ❌ None                     | ✅ Full version history    |


---

### 📌 Key Internals

- 	Delta doesn’t modify Parquet files in place.
- 	It writes new files with updated data, marks old files as removed in the transaction log, and commits atomically.
- 	This is what enables ACID semantics on top of a data lake.

---

### 📝 Summary


✅ Delta Lake supports full ACID operations, including:
- 	UPDATE
- 	DELETE
- 	MERGE (upsert)
- 	Transactions with isolation and durability
- 	Time travel & rollback

All of this happens without requiring a traditional database, just storage (e.g., S3, ADLS, HDFS) + Delta’s transaction log.



